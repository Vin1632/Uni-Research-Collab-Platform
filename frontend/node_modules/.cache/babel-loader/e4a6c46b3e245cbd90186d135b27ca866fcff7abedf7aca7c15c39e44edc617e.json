{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{useNavigate}from\"react-router-dom\";import AdminHeader from\"../components/AdminHeader\";import\"../styles/Dashboard.css\";import{FaImage,FaFlag}from\"react-icons/fa\";// ✅ Added FaFlag icon\nimport{get_project_data}from\"../services/proposal_service\";import{flag_project}from\"../services/proposal_service\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function Dashboard(){const navigate=useNavigate();const[proposals,setProposal]=useState([]);const[user_id,setuser_id]=useState();useEffect(()=>{if(!user_id){console.log(\"User-Id not here\");return;}const fetchProjects=async()=>{try{const project_dat=await get_project_data(user_id);setProposal(project_dat[0]);}catch(err){console.error(\"Failed to fetch Projects\",err);}};fetchProjects();console.log(\"User ID is:\",user_id);},[user_id]);return/*#__PURE__*/_jsxs(\"main\",{className:\"dashboard-wrapper\",children:[/*#__PURE__*/_jsx(AdminHeader,{onUser_IdLoaded:setuser_id}),/*#__PURE__*/_jsx(\"section\",{className:\"dashboard-container\",children:proposals.map(proposal=>/*#__PURE__*/_jsx(ProposalCard,{proposal:proposal,user_id:user_id,onClick:()=>navigate(\"/project_details/\",{state:{project_id:proposal.project_id}})},proposal.project_id))})]});}function ProposalCard(_ref){let{proposal,onClick,user_id}=_ref;const[imgError,setImgError]=useState(false);const[showFlagModal,setShowFlagModal]=useState(false);const[flagReason,setFlagReason]=useState(\"\");const[flagDesc,setFlagDesc]=useState(\"\");const[flagged,setFlagged]=useState(false);const handleFlag=async()=>{if(!flagReason)return alert(\"Please select a reason.\");try{if(!user_id){alert(\"User ID not loaded. Please try again later.\");return;}await flag_project(proposal.project_id,user_id,flagReason,flagDesc);setFlagged(true);setShowFlagModal(false);}catch(err){alert(\"Failed to flag project.\");console.error(err);}};const isImageValid=proposal.link_image&&proposal.link_image.trim()!==\"\"&&!imgError;return/*#__PURE__*/_jsxs(\"article\",{className:\"proposal-card\",children:[/*#__PURE__*/_jsxs(\"div\",{onClick:onClick,children:[isImageValid?/*#__PURE__*/_jsx(\"img\",{src:proposal.link_image,onError:()=>{console.warn(\"Image failed to load:\",proposal.link_image);setImgError(true);},alt:proposal.title,className:\"proposal-image\"}):/*#__PURE__*/_jsx(\"div\",{className:\"proposal-image fallback-icon\",children:/*#__PURE__*/_jsx(FaImage,{size:48,color:\"#aaa\"})}),/*#__PURE__*/_jsx(\"h3\",{className:\"proposal-title\",children:proposal.title}),/*#__PURE__*/_jsx(\"p\",{className:\"proposal-summary\",children:proposal.description})]}),/*#__PURE__*/_jsxs(\"button\",{className:\"flag-btn\",onClick:()=>setShowFlagModal(true),disabled:flagged,children:[/*#__PURE__*/_jsx(FaFlag,{style:{color:flagged?\"#c0392b\":\"#c0392b\"}}),flagged?\"Flagged\":\"Flag\"]}),showFlagModal&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Flag Project\"}),/*#__PURE__*/_jsx(\"label\",{children:\"Reason:\"}),/*#__PURE__*/_jsxs(\"select\",{value:flagReason,onChange:e=>setFlagReason(e.target.value),required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select reason\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Inappropriate Content\",children:\"Inappropriate Content\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Spam\",children:\"Spam\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Other\",children:\"Other\"})]}),/*#__PURE__*/_jsx(\"label\",{children:\"Description (optional):\"}),/*#__PURE__*/_jsx(\"textarea\",{value:flagDesc,onChange:e=>setFlagDesc(e.target.value),rows:\"3\",placeholder:\"Describe why you're flagging this project...\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-actions\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleFlag,children:\"Submit\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowFlagModal(false),children:\"Cancel\"})]})]})})]});}","map":{"version":3,"names":["React","useEffect","useState","useNavigate","AdminHeader","FaImage","FaFlag","get_project_data","flag_project","jsx","_jsx","jsxs","_jsxs","Dashboard","navigate","proposals","setProposal","user_id","setuser_id","console","log","fetchProjects","project_dat","err","error","className","children","onUser_IdLoaded","map","proposal","ProposalCard","onClick","state","project_id","_ref","imgError","setImgError","showFlagModal","setShowFlagModal","flagReason","setFlagReason","flagDesc","setFlagDesc","flagged","setFlagged","handleFlag","alert","isImageValid","link_image","trim","src","onError","warn","alt","title","size","color","description","disabled","style","value","onChange","e","target","required","rows","placeholder"],"sources":["/home/vin/Desktop/Practice/Projects/SDP PROJECT/Projects 3/Uni-Research-Collab-Platform/frontend/src/admin_wrapper/AllProjects.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport AdminHeader from \"../components/AdminHeader\";\nimport \"../styles/Dashboard.css\";\n\nimport { FaImage, FaFlag } from \"react-icons/fa\"; // ✅ Added FaFlag icon\nimport { get_project_data } from \"../services/proposal_service\";\nimport { flag_project } from \"../services/proposal_service\";\n\nexport default function Dashboard() {\n  const navigate = useNavigate();\n  const [proposals, setProposal] = useState([]);\n  const [user_id, setuser_id] = useState();\n\n  useEffect(() => {\n    if (!user_id) {\n      console.log(\"User-Id not here\");\n      return;\n    }\n\n    const fetchProjects = async () => {\n      try {\n        const project_dat = await get_project_data(user_id);\n        setProposal(project_dat[0]);\n      } catch (err) {\n        console.error(\"Failed to fetch Projects\", err);\n      }\n    };\n\n    fetchProjects();\n    console.log(\"User ID is:\", user_id);\n  }, [user_id]);\n\n  return (\n    <main className=\"dashboard-wrapper\">\n      <AdminHeader onUser_IdLoaded={setuser_id} />\n\n      <section className=\"dashboard-container\">\n        {proposals.map((proposal) => (\n          <ProposalCard\n            key={proposal.project_id}\n            proposal={proposal}\n            user_id={user_id}\n            onClick={() =>\n              navigate(`/project_details/`, {\n                state: { project_id: proposal.project_id },\n              })\n            }\n          />\n        ))}\n      </section>\n    </main>\n  );\n}\n\nfunction ProposalCard({ proposal, onClick, user_id }) {\n  const [imgError, setImgError] = useState(false);\n  const [showFlagModal, setShowFlagModal] = useState(false);\n  const [flagReason, setFlagReason] = useState(\"\");\n  const [flagDesc, setFlagDesc] = useState(\"\");\n  const [flagged, setFlagged] = useState(false);\n\n  const handleFlag = async () => {\n    if (!flagReason) return alert(\"Please select a reason.\");\n    try {\n      if (!user_id) {\n        alert(\"User ID not loaded. Please try again later.\");\n        return;\n      }\n      await flag_project(proposal.project_id, user_id, flagReason, flagDesc);\n      setFlagged(true);\n      setShowFlagModal(false);\n    } catch (err) {\n      alert(\"Failed to flag project.\");\n      console.error(err);\n    }\n  };\n\n  const isImageValid =\n    proposal.link_image && proposal.link_image.trim() !== \"\" && !imgError;\n\n  return (\n    <article className=\"proposal-card\">\n      <div onClick={onClick}>\n        {isImageValid ? (\n          <img\n            src={proposal.link_image}\n            onError={() => {\n              console.warn(\"Image failed to load:\", proposal.link_image);\n              setImgError(true);\n            }}\n            alt={proposal.title}\n            className=\"proposal-image\"\n          />\n        ) : (\n          <div className=\"proposal-image fallback-icon\">\n            <FaImage size={48} color=\"#aaa\" />\n          </div>\n        )}\n        <h3 className=\"proposal-title\">{proposal.title}</h3>\n        <p className=\"proposal-summary\">{proposal.description}</p>\n      </div>\n\n      {/* Flag Button with icon */}\n      <button\n        className=\"flag-btn\"\n        onClick={() => setShowFlagModal(true)}\n        disabled={flagged}\n      >\n        <FaFlag style={{ color: flagged ? \"#c0392b\" : \"#c0392b\" }} />\n        {flagged ? \"Flagged\" : \"Flag\"}\n      </button>\n\n      {/* Modal */}\n      {showFlagModal && (\n        <div className=\"modal-overlay\">\n          <div className=\"modal-content\">\n            <h4>Flag Project</h4>\n\n            <label>Reason:</label>\n            <select\n              value={flagReason}\n              onChange={(e) => setFlagReason(e.target.value)}\n              required\n            >\n              <option value=\"\">Select reason</option>\n              <option value=\"Inappropriate Content\">\n                Inappropriate Content\n              </option>\n              <option value=\"Spam\">Spam</option>\n              <option value=\"Other\">Other</option>\n            </select>\n\n            <label>Description (optional):</label>\n            <textarea\n              value={flagDesc}\n              onChange={(e) => setFlagDesc(e.target.value)}\n              rows=\"3\"\n              placeholder=\"Describe why you're flagging this project...\"\n            />\n\n            <div className=\"modal-actions\">\n              <button onClick={handleFlag}>Submit</button>\n              <button onClick={() => setShowFlagModal(false)}>Cancel</button>\n            </div>\n          </div>\n        </div>\n      )}\n    </article>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}